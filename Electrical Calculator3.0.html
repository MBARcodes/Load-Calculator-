<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Electrical Load Planner - Fixed Multiplier</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, select, button { padding: 6px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    label { display: inline-block; }
  </style>
</head>
<body>
  <h2>Electrical Load Calculator (Philippines) — Fixed Multiplier</h2>

  <form id="loadForm" novalidate>
    <label>CircuitNo: <input type="number" id="circuitno"required></label>
    <label>Load Description:
      <select id="loadDesc" required>
        <option value="">-- Select Load --</option>
        <option value="LED Bulb">LED Bulb</option>
        <option value="Fluorescent Lamp">Fluorescent Lamp</option>
        <option value="Refrigerator">Refrigerator</option>
        <option value="Washing Machine">Washing Machine</option>
        <option value="Electric Fan">Electric Fan</option>
        <option value="Exhaust Fan">Exhaust Fan</option>
        <option value="Microwave Oven">Microwave Oven</option>
        <option value="Rice Cooker">Rice Cooker</option>
        <option value="Water Heater">Water Heater</option>
        <option value="Rangehood">Rangehood</option>
        <option value="Water Pump">Water Pump</option>
        <option value="Air Conditioner less than 1HP">Air Conditioner &lt; 1 HP</option>
        <option value="Air Conditioner 1HP">Air Conditioner (1 HP)</option>
        <option value="Air Conditioner 1.5HP">Air Conditioner (1.5 HP)</option>
        <option value="Air Conditioner 2HP">Air Conditioner (2 HP)</option>
        <option value="Convenience Outlet">Convenience Outlet</option>
        <option value="Ckt Total">Ckt Total</option>
      </select>
    </label>

    <label>Voltage (V): <input type="number" id="voltage" value="230" required></label>
    <label>Power (W): <input type="number" id="wattage" required></label>
    <label>Quantity: <input type="number" id="quantity" value="1" required></label>

    <!-- Multiplier: allow decimals, help mobile keyboards, placeholder -->
    <label>Multiplier:
      <input
        type="number"
        id="multiplier"
        step="any"
        inputmode="decimal"
        placeholder="e.g. 1.25"
        required
      >
    </label>

    <!-- Free text comment -->
    <label>Comment:
      <input type="text" id="comment" placeholder="Enter comment (optional)">
    </label>

    <button type="submit">Add Load</button>
  </form>

  <button onclick="downloadToExcel()">Download to Excel</button>

  <table id="loadTable">
    <thead>
      <tr>
        <th>#</th>
        <th>CircuitNo</th>
        <th>Load Description</th>
        <th>Voltage (V)</th>
        <th>Power (W)</th>
        <th>Quantity</th>
        <th>Total VA</th>
        <th>Current (A)</th>
        <th>Current (A)Multiplier</th>
        <th>Wire Size</th>
        <th>CB Size</th>
        <th>Ground Wire</th>
        <th>Conductor Type</th>
        <th>Conduit</th>
        <th>Comment</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <script>
    const loadDefaults = {
      "LED Bulb": { multiplier: 1 },
      "Fluorescent Lamp": { multiplier: 1 },
      "Refrigerator": { multiplier: 1.25 },
      "Washing Machine": { multiplier: 1.5 },
      "Electric Fan": { multiplier: 1 },
      "Exhaust Fan": { multiplier: 1.25 },
      "Microwave Oven": { multiplier: 1.25 },
      "Rice Cooker": { multiplier: 1 },
      "Water Heater": { multiplier: 1.25 },
      "Rangehood": { multiplier: 1.25 },
      "Water Pump": { multiplier: 2 },
      "Air Conditioner less than 1HP": { multiplier: 1.5 },
      "Air Conditioner 1HP": { multiplier: 1.75 },
      "Air Conditioner 1.5HP": { multiplier: 1.75 },
      "Air Conditioner 2HP": { multiplier: 2 },
      "Convenience Outlet": { multiplier: 1 },
      "Ckt Total": { multiplier: 1 },
    };

    const wireAmpacity = {
      "2.0 mm²": 25,
      "3.5 mm²": 30,
      "5.5 mm²": 40,
      "8.0 mm²": 55,
      "14.0 mm²": 75,
      "22.0 mm²": 95,
      "30.0 mm²": 115,

    };

    const groundSizes = {
      
      "2.0 mm²": "2.0 mm²",
      "3.5 mm²": "2.0 mm²",
      "5.5 mm²": "3.5 mm²",
      "8.0 mm²": "5.5 mm²",
      "14.0 mm²": "5.5 mm²",
    };

    let loadCount = 0;

    document.getElementById("loadDesc").addEventListener("change", function () {
      const selected = this.value;
      if (loadDefaults[selected]) {
        document.getElementById("multiplier").value = loadDefaults[selected].multiplier;
      }
    });

    document.getElementById('loadForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const circuitNo = document.getElementById('circuitno').value;
      const desc = document.getElementById('loadDesc').value;
      const voltage = parseFloat(document.getElementById('voltage').value);
      const wattage = parseFloat(document.getElementById('wattage').value);
      const quantity = parseInt(document.getElementById('quantity').value, 10);

      // Sanitize multiplier: accept comma or dot, validate
      let multRaw = document.getElementById('multiplier').value.trim();
      multRaw = multRaw.replace(',', '.'); // allow comma decimal
      const multiplier = multRaw === '' ? 1 : parseFloat(multRaw);

      if (Number.isNaN(multiplier)) {
        alert('Invalid multiplier — please enter a number like 1.25');
        return;
      }

      const comment = document.getElementById('comment').value.trim() || '—';

      const totalVA = wattage * quantity;
      const current = parseFloat((totalVA / voltage).toFixed(2));
      const currentmultiplier = parseFloat((current * multiplier).toFixed(2));
      const wireSize = getWireSize(currentmultiplier);
      const cbSize = getCBSize(current * multiplier);
      const groundWire = wireSize;

      const table = document.getElementById('loadTable').querySelector('tbody');
      const row = table.insertRow();
      loadCount++;
      row.innerHTML = `
        <td>${loadCount}</td>
        <td>${circuitNo}</td>
        <td>${desc}</td>
        <td>${voltage}</td>
        <td>${wattage}</td>
        <td>${quantity}</td>
        <td>${totalVA}</td>
        <td>${current}</td>
        <td>${currentmultiplier}</td>
        <td>${wireSize}</td>
        <td>${cbSize} A</td>
        <td>${groundWire}</td>
        <td>THHN</td>
        <td>PVC</td>
        <td>${escapeHtml(comment)}</td>
      `;

      // Reset form but keep voltage
      document.getElementById('loadForm').reset();
      document.getElementById('voltage').value = 230;
    });

    function getWireSize(current) {
      for (const [size, amp] of Object.entries(wireAmpacity)) {
        if (current <= amp) return size;
      }
      return "Special";
    }

    function getCBSize(currentmultiplier) {
  if (currentmultiplier <= 25) return 15;
  else if (currentmultiplier <= 30) return 20;
  else if (currentmultiplier <= 40) return 30;
  else if (currentmultiplier <= 55) return 40;
  else if (currentmultiplier <= 75) return 60;
  else if (currentmultiplier <= 95) return 80;
  else if (currentmultiplier <= 115) return 100;
  else if (currentmultiplier <= 130) return 125;
  else if (currentmultiplier <= 150) return 150;
  else return 170;
}
  

    function downloadToExcel() {
      const table = document.getElementById('loadTable');
      const wb = XLSX.utils.table_to_book(table, { sheet: "Electrical Loads" });
      XLSX.writeFile(wb, "Electrical_Load_Schedule.xlsx");
    }

    // tiny helper to avoid injecting raw HTML in comment cell
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
  </script>
</body>
</html>

